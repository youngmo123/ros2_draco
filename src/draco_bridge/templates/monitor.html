<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draco Bridge Monitor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .status-card:hover {
            transform: translateY(-5px);
        }
        
        .status-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 8px 0;
        }
        
        .status-indicator {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .connected {
            background: #4CAF50;
            color: white;
        }
        
        .disconnected {
            background: #f44336;
            color: white;
        }
        
        .compression-info {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .size-display {
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            margin: 5px 0;
        }
        
        .ratio-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #2196F3;
            text-align: center;
            margin: 10px 0;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 15px;
            max-height: 350px;
        }
        
        .chart-title {
            text-align: center;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .system-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2196F3;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .timestamp {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 20px;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Draco Bridge Monitor</h1>
            <p>ì‹¤ì‹œê°„ ì••ì¶• ë° ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§</p>
        </div>
        
        <div class="status-grid">
            <!-- ì—°ê²° ìƒíƒœ ì¹´ë“œ (ê°„ì†Œí™”) -->
            <div class="status-card">
                <h3>ğŸ”— ì—°ê²° ìƒíƒœ</h3>
                <div class="status-item">
                    <span>ì¸ì½”ë” ì„œë²„:</span>
                    <span class="status-indicator disconnected" id="encoder-status">ì—°ê²° ëŠê¹€</span>
                </div>
                <div class="status-item">
                    <span>ë””ì½”ë” í´ë¼ì´ì–¸íŠ¸:</span>
                    <span class="status-indicator disconnected" id="decoder-status">ì—°ê²° ëŠê¹€</span>
                </div>
                <div class="status-item">
                    <span>ë„¤íŠ¸ì›Œí¬ ì—°ê²°:</span>
                    <span class="status-indicator disconnected" id="network-status">ì—°ê²° ëŠê¹€</span>
                </div>
                <div class="status-item">
                    <span>í™œì„± ì—°ê²° ìˆ˜:</span>
                    <span id="connection-count">0</span>
                </div>
            </div>
            
            <!-- ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ì¹´ë“œ (ìƒˆë¡œ ì¶”ê°€) -->
            <div class="status-card">
                <h3>ğŸŒ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­</h3>
                <div class="status-item">
                    <span>ì†¡ì‹  ëŒ€ì—­í­:</span>
                    <span id="bandwidth-sent">0 B/s</span>
                </div>
                <div class="status-item">
                    <span>ìˆ˜ì‹  ëŒ€ì—­í­:</span>
                    <span id="bandwidth-recv">0 B/s</span>
                </div>
                <div class="status-item">
                    <span>ì „ì†¡ ì†ë„ (bps):</span>
                    <span id="upload-bps">0 bps</span>
                </div>
                <div class="status-item">
                    <span>ìˆ˜ì‹  ì†ë„ (bps):</span>
                    <span id="download-bps">0 bps</span>
                </div>
                <div class="status-item">
                    <span>ì‹¤ì‹œê°„ ì—…ë¡œë“œ:</span>
                    <span id="realtime-upload">0.00 Mbps</span>
                </div>
                <div class="status-item">
                    <span>ì‹¤ì‹œê°„ ë‹¤ìš´ë¡œë“œ:</span>
                    <span id="realtime-download">0.00 Mbps</span>
                </div>
                <div class="status-item">
                    <span>í…ŒìŠ¤íŠ¸ ìƒíƒœ:</span>
                    <span id="test-status">ëŒ€ê¸° ì¤‘</span>
                </div>
                <div class="status-item">
                    <span>ë§ˆì§€ë§‰ í…ŒìŠ¤íŠ¸:</span>
                    <span id="last-test-time">-</span>
                </div>
            </div>
            
            <!-- ì••ì¶• ì •ë³´ ì¹´ë“œ -->
            <div class="status-card">
                <h3>ğŸ“Š ì••ì¶• í†µê³„</h3>
                <div class="compression-info">
                    <div class="size-display">ì›ë³¸ í¬ê¸°: <span id="original-size">0</span> bytes</div>
                    <div class="size-display">ì••ì¶• í¬ê¸°: <span id="compressed-size">0</span> bytes</div>
                    <div class="ratio-display" id="compression-ratio">0%</div>
                    <div style="text-align: center; color: #666; font-size: 0.9em;">
                        ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="last-update">-</span>
                    </div>
                </div>
            </div>
            
            <!-- ì‹œìŠ¤í…œ ì •ë³´ ì¹´ë“œ -->
            <div class="status-card">
                <h3>ğŸ’» ì‹œìŠ¤í…œ ì •ë³´</h3>
                <div class="system-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="cpu-percent">0%</div>
                        <div class="stat-label">CPU ì‚¬ìš©ë¥ </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="memory-percent">0%</div>
                        <div class="stat-label">ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ </div>
                    </div>
                </div>
                <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                    <div>ë©”ëª¨ë¦¬: <span id="memory-used">0</span>GB / <span id="memory-total">0</span>GB</div>
                </div>
            </div>
        </div>
        
        <!-- ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ -->
        <div class="chart-container">
            <div class="chart-title">ğŸ“ˆ ì••ì¶•ë¥  ì¶”ì´</div>
            <canvas id="compressionChart" width="400" height="180"></canvas>
        </div>
        
        <div class="timestamp">
            ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="timestamp">-</span>
        </div>
    </div>

    <script>
        // Socket.IO ì—°ê²°
        const socket = io();
        
        // ì°¨íŠ¸ ì„¤ì •
        const ctx = document.getElementById('compressionChart').getContext('2d');
        const compressionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'ì••ì¶•ë¥  (%)',
                    data: [],
                    borderColor: '#2196F3',
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                            display: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatus(data) {
            // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
            updateStatusIndicator('encoder-status', data.encoder_status);
            updateStatusIndicator('decoder-status', data.decoder_status);
            updateStatusIndicator('network-status', data.network_status);
            
            // ì—°ê²° ìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('connection-count').textContent = data.connection_count;
            
            // ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ì—…ë°ì´íŠ¸
            document.getElementById('bandwidth-sent').textContent = formatBytes(data.network_bandwidth.bytes_sent_per_sec) + '/s';
            document.getElementById('bandwidth-recv').textContent = formatBytes(data.network_bandwidth.bytes_recv_per_sec) + '/s';
            
            // ê³ ê¸‰ ëŒ€ì—­í­ ì •ë³´ ì—…ë°ì´íŠ¸
            if (data.bandwidth_results) {
                const bw = data.bandwidth_results;
                
                // ì „ì†¡/ìˆ˜ì‹  ì†ë„ (bps)
                document.getElementById('upload-bps').textContent = formatBps(parseFloat(bw.upload_speed_bps || 0));
                document.getElementById('download-bps').textContent = formatBps(parseFloat(bw.download_speed_bps || 0));
                
                // ì‹¤ì‹œê°„ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ
                document.getElementById('realtime-upload').textContent = (bw.realtime_upload_mbps || '0.00') + ' Mbps';
                document.getElementById('realtime-download').textContent = (bw.realtime_download_mbps || '0.00') + ' Mbps';
                
                // í…ŒìŠ¤íŠ¸ ìƒíƒœ
                document.getElementById('test-status').textContent = getTestStatusText(bw.test_status);
                document.getElementById('last-test-time').textContent = bw.last_test_time || '-';
            }
            
            // ì••ì¶• í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('original-size').textContent = formatBytes(data.compression_stats.original_size);
            document.getElementById('compressed-size').textContent = formatBytes(data.compression_stats.compressed_size);
            document.getElementById('compression-ratio').textContent = data.compression_stats.compression_ratio + '%';
            document.getElementById('last-update').textContent = data.compression_stats.last_update || '-';
            
            // ì‹œìŠ¤í…œ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('cpu-percent').textContent = data.system_info.cpu_percent.toFixed(1) + '%';
            document.getElementById('memory-percent').textContent = data.system_info.memory_percent.toFixed(1) + '%';
            document.getElementById('memory-used').textContent = data.system_info.memory_used_gb;
            document.getElementById('memory-total').textContent = data.system_info.memory_total_gb;
            
            // íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸
            document.getElementById('timestamp').textContent = data.timestamp;
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateChart(data.compression_stats.compression_ratio);
        }
        
        function updateStatusIndicator(elementId, status) {
            const element = document.getElementById(elementId);
            if (status === 'connected') {
                element.textContent = 'ì—°ê²°ë¨';
                element.className = 'status-indicator connected';
            } else {
                element.textContent = 'ì—°ê²° ëŠê¹€';
                element.className = 'status-indicator disconnected';
            }
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatBps(bps) {
            if (bps === 0) return '0 bps';
            if (bps >= 1_000_000_000) {
                return (bps / 1_000_000_000).toFixed(2) + ' Gbps';
            } else if (bps >= 1_000_000) {
                return (bps / 1_000_000).toFixed(2) + ' Mbps';
            } else if (bps >= 1_000) {
                return (bps / 1_000).toFixed(2) + ' Kbps';
            } else {
                return bps.toFixed(0) + ' bps';
            }
        }
        
        function getTestStatusText(status) {
            const statusMap = {
                'idle': 'ëŒ€ê¸° ì¤‘',
                'testing': 'í…ŒìŠ¤íŠ¸ ì¤‘...',
                'completed': 'ì™„ë£Œ',
                'failed': 'ì‹¤íŒ¨'
            };
            return statusMap[status] || 'ì•Œ ìˆ˜ ì—†ìŒ';
        }
        
        function updateChart(compressionRatio) {
            const now = new Date().toLocaleTimeString();
            compressionChart.data.labels.push(now);
            compressionChart.data.datasets[0].data.push(compressionRatio);
            
            // ìµœëŒ€ 20ê°œ ë°ì´í„° í¬ì¸íŠ¸ë§Œ ìœ ì§€
            if (compressionChart.data.labels.length > 20) {
                compressionChart.data.labels.shift();
                compressionChart.data.datasets[0].data.shift();
            }
            
            compressionChart.update('none');
        }
        
        // Socket.IO ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        socket.on('connect', function() {
            console.log('WebSocket ì—°ê²°ë¨');
        });
        
        socket.on('status_update', function(data) {
            updateStatus(data);
        });
        
        socket.on('disconnect', function() {
            console.log('WebSocket ì—°ê²° ëŠê¹€');
        });
    </script>
</body>
</html>
